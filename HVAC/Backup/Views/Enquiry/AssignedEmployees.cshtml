@model HVAC.Models.EnquiryVM
@{
    var i = 0;
    var _decimal = @Session["Decimal"].ToString();
}


<div class="card">
    <div class="card-body">

        <div class="row" style="border-bottom:1px solid #dedede">
            <div class="col-md-8">
                <div class="me-2">
                    <h5 class="card-title mt-1 mb-0">Assigned Employees</h5>
                </div>
            </div>
            <div class="col-md-4 text-md-end">
                <a class="text-muted font-size-14 text-primary" href="#" role="button" onclick="ShowEngineerEntry()" aria-expanded="false">
                    <i class="dripicons-plus mt-1 text-primary" style="font-size: 22px;"></i>
                </a>
                @*<button type="button" class="text-primary" id="btnaddclient" title="New Equipment" onclick="ShowEquipmentEntry()">
                        <i class="dripicons-plus mt-1" style="font-size: 18px;"></i>
                    </button>*@

            </div>
        </div>
        <div data-simplebar="init" style="max-height: 295px;" class="simplebar-scrollable-y">
            <div class="simplebar-wrapper" style="margin: 0px;">
                <div class="simplebar-height-auto-observer-wrapper">
                    <div class="simplebar-height-auto-observer"></div>
                </div><div class="simplebar-mask">
                    <div class="simplebar-offset" style="right: 0px; bottom: 0px;">
                        <div class="simplebar-content-wrapper" tabindex="0" role="region" aria-label="scrollable content" style="height: auto; overflow: hidden scroll;">
                            <div class="simplebar-content" style="padding: 0px;" id="divEquipmentContainer">

                                <ul class="list-group list-group-flush">
                                    @foreach (var item in Model.EmployeeDetails)
                                    {

                                        <li class="list-group-item py-3" id="trclient_@i" style="padding-left:0.05rem">
                                            <div class="d-flex">
                                                <div class="me-3">

                                                    <div class="avatar-group-item">
                                                        <a href="javascript: void(0);" class="d-inline-block">
                                                            <div class="avatar-xs">
                                                                <span class="avatar-title rounded-circle bg-success text-white font-size-13">
                                                                    @item.EmployeeShortName
                                                                </span>
                                                            </div>
                                                        </a>
                                                    </div>
                                                </div>

                                                <div class="align-self-center overflow-hidden me-auto">
                                                    <div>
                                                        <h5 class="font-size-13 text-truncate"><a href="javascript: void(0);" class="text-dark"> @item.EmployeeName</a></h5>
                                                        @*<span class="badge rounded-pill badge-soft-secondary font-size-11">@item.</span>*@
                                                        <p class="text-muted mb-0 font-size-10">
                                                            @item.CreatedDate
                                                        </p>
                                                        @Html.HiddenFor(model => model.EmployeeDetails[i].ID, new { @Value = @item.ID, @id = "hdnEmployeeId_" + @i })

                                                    </div>
                                                </div>
                                                <div class="text-muted">
                                                    <a class="text-muted font-size-14 text-danger" href="#"><a class="text-danger" onclick="DeleteEnquiryEmployee('@item.ID','@i')" href="javascript:void(0);" title="UnAssign Employee"><i class="mdi mdi-delete font-size-15"></i></a></a>
                                                    @*<a class="text-muted font-size-14 text-danger" href="#"><a class="text-primary" href="javascript:void(0);" title="Show Quotation"><i class="mdi mdi-eye font-size-18"></i></a></a>*@
                                                    <a class="text-primary" href="javascript:void(0);" title="Show Quotation"
                                                       onclick="toggleQuotation('@item.EmployeeID')">
                                                        <i class="mdi mdi-eye font-size-15" id="plusIcon_@i"></i>
                                                    </a>
                                                </div>

                                            </div>
                                            <!-- Collapsible content goes right beneath the row -->
                                            <div id="quotation_@item.EmployeeID" class="quotation-div" style="display:none;">
                                                
                                            </div>
                                        </li>
                                    }
                                </ul>

                            </div>
                            <!-- end tab content -->
                        </div>
                    </div>
                </div>
            </div><div class="simplebar-placeholder" style="width: 698px; height: 323px;"></div>
        </div>
        <div class="simplebar-track simplebar-horizontal" style="visibility: hidden;"><div class="simplebar-scrollbar" style="width: 0px; display: none;"></div></div><div class="simplebar-track simplebar-vertical" style="visibility: visible;"><div class="simplebar-scrollbar" style="height: 269px; transform: translate3d(0px, 0px, 0px); display: block;"></div></div>
    </div>
</div>
<script>
    function toggleQuotation(empId) {
        // Hide all quotation divs first
        document.querySelectorAll(".quotation-div").forEach(div => {
            if (div.id !== "quotation_" + empId) {
                div.style.display = "none";
            }
        });

        // Show only the selected employee's quotation div
        let targetDiv = document.getElementById("quotation_" + empId);
        if (targetDiv) {
            if (targetDiv.style.display === "block") {
                // If already visible → hide
                targetDiv.style.display = "none";
            } else {
                // If hidden → show
                targetDiv.style.display = "block";
            }
        }

        $.ajax({
            type: 'POST',
            url: '/Enquiry/ShowEmployeeQuotation',
            datatype: "html",
            data: {
                EnquiryID: $('#EnquiryID').val(),EmployeeID :empId
            },
            success: function (data) {
                $(targetDiv).html(data);
            }
        });
    }
</script>