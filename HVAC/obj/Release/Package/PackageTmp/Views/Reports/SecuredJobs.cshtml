@model HVAC.Models.CurrentMonthSecuredJobsViewModel
@{
    ViewBag.Title = "Monthly Secured Jobs";
    if (Model.ReportClass!="")
    {
        Layout = null;
    }
    else {
        Layout = "~/Views/Shared/_Layout.cshtml";
    }

}

<style>
    .pdfenable {
        display: none;
    }
</style>

@using (Html.BeginForm("SecuredJobs", "Reports", FormMethod.Post, new { @id = "report" }))
{
    @Html.AntiForgeryToken()

    @Html.ValidationSummary(true, "", new { @class = "text-danger" })
    <div class="row @Model.ReportClass">
        <div class="col-md-2">
            <lable class="col-form-label">Select Year</lable>
            @Html.DropDownListFor(m => m.SelectedYear, new SelectList(@Model.Years, @Model.SelectedYear),
                   "Select Year", new { @class = "form-select", onchange = "this.form.submit();" })
        </div>
        <div class="col-md-2">
            <lable class="col-form-label">Select Month</lable>
            @Html.DropDownListFor(m => m.SelectedMonth, Model.Months,"-- Select Month --",new { @class = "form-control",onchange = "this.form.submit();" })

        </div>
        <div class="col-md-8 text-md-end">
            <a href="@Url.Action("SecuredJobsPrint","Reports",new { SelectedMonth = Model.SelectedMonth, SelectedYear = Model.SelectedYear })"
               class="btn btn-warning" target="_blank">
                <i class="fa fa-file-download" style="font-size:18px"></i> Download PDF
            </a>
        </div>
    </div>
    <div class="row">
        <div class="mt-2 text-center">
            <h3 id="reporttitle">Secured Jobs List  @Model.SelectedMonthName @Model.SelectedYear</h3>
        </div>
    </div>
    <table style="width:100%; border:1px solid #ddd; border-collapse:collapse; font-family:Arial, sans-serif; font-size:14px;">
        <thead>
            <tr style="background:#808080;color:white; border-bottom:2px solid #fff;">
                <th style="width:100px; padding:8px; text-align:left;">Sl No.</th>
                <th style="padding:8px; text-align:left;">Project Title</th>
                <th style="padding:8px; text-align:right;">Value in OMR</th>
            </tr>
        </thead>

        <tbody>
            @foreach (dynamic group in Model.Groups)
            {
                <!-- Category Header -->
                <tr style="background:#f1f3f5; font-weight:bold;">
                    <td colspan="3" style="padding:8px;">@group.Category</td>
                </tr>

                int i = 1;
                foreach (dynamic job in group.Jobs)
                {
                    <tr style="border-bottom:1px solid #eee;">
                        <td style="padding:8px;">@i</td>
                        <td style="padding:8px;">@job.ProjectTitle</td>
                        <td style="padding:8px; text-align:right;">@job.ValueInOMR.ToString("N3")</td>
                    </tr>
                    i++;
                }

                <!-- Category Total -->
                <tr style="background:#c1bdbd; font-weight:bold;">
                    <td colspan="2" style="padding:8px; text-align:right;">TOTAL</td>
                    <td style="padding:8px; text-align:right;">@group.CategoryTotal.ToString("N3")</td>
                </tr>
            }

            <!-- Grand Total -->
            <tr style="background:#a9a5a5; font-weight:bold; font-size:15px;">
                <td colspan="2" style="padding:8px; text-align:right;">GRAND TOTAL</td>
                <td style="padding:8px; text-align:right;">@Model.GrandTotal.ToString("N3")</td>
            </tr>
        </tbody>
    </table>
}